<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Transactional Delta (DTD) System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .market-price {
            font-size: 3em;
            font-weight: bold;
            color: #2ecc71;
            text-align: center;
            margin: 20px 0;
        }

        .traders-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .trader-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .trader-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 10px;
            padding: 20px;
            border-left: 5px solid #667eea;
            transition: transform 0.3s ease;
        }

        .trader-card:hover {
            transform: translateY(-5px);
        }

        .trader-card.scalper {
            border-left-color: #e74c3c;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe0e0 100%);
        }

        .trader-card.normal {
            border-left-color: #3498db;
            background: linear-gradient(135deg, #f0f8ff 0%, #d4e9ff 100%);
        }

        .trader-card.longterm {
            border-left-color: #2ecc71;
            background: linear-gradient(135deg, #f0fff4 0%, #d4f4dd 100%);
        }

        .trader-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .trader-name {
            font-weight: bold;
            font-size: 1.1em;
        }

        .trader-type {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8em;
            font-weight: bold;
            text-transform: uppercase;
        }

        .type-scalper {
            background: #e74c3c;
            color: white;
        }

        .type-normal {
            background: #3498db;
            color: white;
        }

        .type-longterm {
            background: #2ecc71;
            color: white;
        }

        .velocity-score {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .velocity-bar {
            width: 100%;
            height: 30px;
            background: #ecf0f1;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
        }

        .velocity-fill {
            height: 100%;
            background: linear-gradient(90deg, #2ecc71 0%, #f39c12 50%, #e74c3c 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .stat-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.8em;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .stat-value {
            font-weight: bold;
            font-size: 1.1em;
            color: #2c3e50;
        }

        .pricing {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
        }

        .pricing h4 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin: 8px 0;
            font-size: 0.9em;
        }

        .price-penalty {
            color: #e74c3c;
            font-weight: bold;
        }

        .controls {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .control-group {
            margin-bottom: 20px;
        }

        .control-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin: 5px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .btn-danger {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        .info-box {
            background: #e8f4fd;
            border-left: 4px solid #3498db;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }

        .info-box h3 {
            color: #2980b9;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .info-box ul {
            margin-left: 20px;
        }

        .info-box li {
            margin: 5px 0;
            color: #34495e;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .trading {
            animation: pulse 1s infinite;
        }

        .legend {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üéØ Dynamic Transactional Delta (DTD) System</h1>
            <p class="subtitle">AI-Driven Behavioral Pricing for Trading Platforms</p>
        </header>

        <div class="dashboard">
            <div class="card">
                <h2>üìä Global Market Price</h2>
                <div class="market-price" id="marketPrice">$50,000.00</div>
                <p style="text-align: center; color: #7f8c8d;">Unchanged for all participants</p>
            </div>

            <div class="card">
                <h2>‚ö° System Status</h2>
                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Active Traders</div>
                        <div class="stat-value" id="activeTraders">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Total Trades</div>
                        <div class="stat-value" id="totalTrades">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">High Velocity</div>
                        <div class="stat-value" id="highVelocity">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Adjustments Applied</div>
                        <div class="stat-value" id="adjustments">0</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2>üéõÔ∏è DTD Configuration</h2>
                <div class="control-group">
                    <label>Base Spread Multiplier</label>
                    <input type="range" id="spreadMultiplier" min="1" max="10" value="3" step="0.5" style="width: 100%;">
                    <span id="spreadValue">3.0x</span>
                </div>
                <div class="control-group">
                    <label>Velocity Threshold</label>
                    <input type="range" id="velocityThreshold" min="30" max="90" value="60" style="width: 100%;">
                    <span id="thresholdValue">60</span>
                </div>
            </div>
        </div>

        <div class="controls">
            <h2 style="color: #667eea; margin-bottom: 15px;">‚öôÔ∏è Simulation Controls</h2>
            <button onclick="addTrader('scalper')">Add Scalper (High-Frequency)</button>
            <button onclick="addTrader('normal')">Add Normal Trader</button>
            <button onclick="addTrader('longterm')">Add Long-Term Trader</button>
            <button class="btn-danger" onclick="resetSimulation()">Reset Simulation</button>
            
            <div class="legend">
                <div class="legend-item">
                    <div class="legend-color" style="background: #e74c3c;"></div>
                    <span>Scalper (High Velocity)</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #3498db;"></div>
                    <span>Normal Trader</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #2ecc71;"></div>
                    <span>Long-Term Trader</span>
                </div>
            </div>
        </div>

        <div class="traders-section">
            <h2 style="color: #667eea;">üë• Active Traders (Real-Time Monitoring)</h2>
            <div class="trader-grid" id="traderGrid"></div>
        </div>

        <div class="info-box">
            <h3>üìñ How the DTD System Works</h3>
            <ul>
                <li><strong>Velocity Score:</strong> Calculated from trade frequency, holding time, and repetitive patterns</li>
                <li><strong>Individual Pricing:</strong> Market price stays the same, but execution conditions adjust per trader</li>
                <li><strong>Elastic Spread:</strong> High-velocity traders get slightly worse buy/sell prices</li>
                <li><strong>Purpose:</strong> Makes ultra-short scalping less profitable without banning traders</li>
                <li><strong>Fair System:</strong> Long-term traders are unaffected as their profit targets exceed micro-adjustments</li>
            </ul>
        </div>
    </div>

    <script>
        // System Configuration
        let marketPrice = 50000;
        let traders = [];
        let totalTrades = 0;
        let adjustmentsApplied = 0;
        let traderIdCounter = 0;

        // Trader profiles
        const traderProfiles = {
            scalper: {
                type: 'Scalper',
                className: 'scalper',
                typeClass: 'type-scalper',
                tradeFrequency: { min: 8, max: 15 }, // trades per minute
                holdingTime: { min: 5, max: 30 }, // seconds
                baseVelocity: 85
            },
            normal: {
                type: 'Normal',
                className: 'normal',
                typeClass: 'type-normal',
                tradeFrequency: { min: 2, max: 5 },
                holdingTime: { min: 120, max: 600 },
                baseVelocity: 40
            },
            longterm: {
                type: 'Long-Term',
                className: 'longterm',
                typeClass: 'type-longterm',
                tradeFrequency: { min: 0.2, max: 1 },
                holdingTime: { min: 3600, max: 86400 },
                baseVelocity: 15
            }
        };

        // Add a trader
        function addTrader(type) {
            const profile = traderProfiles[type];
            const trader = {
                id: ++traderIdCounter,
                name: `Trader ${traderIdCounter}`,
                type: profile.type,
                className: profile.className,
                typeClass: profile.typeClass,
                trades: 0,
                velocityScore: profile.baseVelocity + Math.random() * 10,
                tradesPerMinute: 0,
                avgHoldingTime: 0,
                profile: profile,
                lastTradeTime: Date.now(),
                isTrading: false
            };

            traders.push(trader);
            renderTrader(trader);
            startTrading(trader);
            updateStats();
        }

        // Render trader card
        function renderTrader(trader) {
            const grid = document.getElementById('traderGrid');
            const card = document.createElement('div');
            card.className = `trader-card ${trader.className}`;
            card.id = `trader-${trader.id}`;
            
            card.innerHTML = `
                <div class="trader-header">
                    <span class="trader-name">${trader.name}</span>
                    <span class="trader-type ${trader.typeClass}">${trader.type}</span>
                </div>
                
                <div class="velocity-score">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                        <strong>Velocity Score</strong>
                        <span id="velocity-${trader.id}" style="color: #e74c3c; font-weight: bold;">0</span>
                    </div>
                    <div class="velocity-bar">
                        <div class="velocity-fill" id="velocity-bar-${trader.id}" style="width: 0%">0%</div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-item">
                        <div class="stat-label">Trades</div>
                        <div class="stat-value" id="trades-${trader.id}">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">TPM</div>
                        <div class="stat-value" id="tpm-${trader.id}">0</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Avg Hold</div>
                        <div class="stat-value" id="hold-${trader.id}">0s</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-label">Status</div>
                        <div class="stat-value" id="status-${trader.id}">Active</div>
                    </div>
                </div>

                <div class="pricing" id="pricing-${trader.id}">
                    <h4>‚ö° Execution Pricing</h4>
                    <div class="price-row">
                        <span>Market Price:</span>
                        <span>$${marketPrice.toFixed(2)}</span>
                    </div>
                    <div class="price-row">
                        <span>Your Buy Price:</span>
                        <span id="buy-price-${trader.id}">$${marketPrice.toFixed(2)}</span>
                    </div>
                    <div class="price-row">
                        <span>Your Sell Price:</span>
                        <span id="sell-price-${trader.id}">$${marketPrice.toFixed(2)}</span>
                    </div>
                    <div class="price-row">
                        <span>Spread Penalty:</span>
                        <span class="price-penalty" id="penalty-${trader.id}">$0.00</span>
                    </div>
                </div>
            `;

            grid.appendChild(card);
        }

        // Start trading simulation
        function startTrading(trader) {
            function executeTrade() {
                if (!traders.find(t => t.id === trader.id)) return;

                trader.isTrading = true;
                const card = document.getElementById(`trader-${trader.id}`);
                if (card) card.classList.add('trading');

                // Execute trade
                trader.trades++;
                totalTrades++;

                // Calculate trade metrics
                const profile = trader.profile;
                const frequency = profile.tradeFrequency.min + 
                    Math.random() * (profile.tradeFrequency.max - profile.tradeFrequency.min);
                const holdTime = profile.holdingTime.min + 
                    Math.random() * (profile.holdingTime.max - profile.holdingTime.min);

                trader.tradesPerMinute = frequency;
                trader.avgHoldingTime = holdTime;

                // Calculate velocity score
                const freqScore = Math.min((frequency / 15) * 50, 50);
                const holdScore = Math.max(50 - (holdTime / 600) * 50, 0);
                trader.velocityScore = Math.min(freqScore + holdScore, 100);

                // Calculate pricing adjustments
                const threshold = parseInt(document.getElementById('velocityThreshold').value);
                const spreadMultiplier = parseFloat(document.getElementById('spreadMultiplier').value);
                
                let adjustment = 0;
                if (trader.velocityScore > threshold) {
                    const excessVelocity = (trader.velocityScore - threshold) / (100 - threshold);
                    adjustment = marketPrice * 0.001 * spreadMultiplier * excessVelocity;
                    adjustmentsApplied++;
                }

                const buyPrice = marketPrice + adjustment;
                const sellPrice = marketPrice - adjustment;

                // Update UI
                updateTraderUI(trader, buyPrice, sellPrice, adjustment);

                setTimeout(() => {
                    if (card) card.classList.remove('trading');
                    trader.isTrading = false;
                }, 500);

                // Schedule next trade
                const nextTradeDelay = (60000 / frequency) * (0.8 + Math.random() * 0.4);
                setTimeout(executeTrade, nextTradeDelay);
            }

            executeTrade();
        }

        // Update trader UI
        function updateTraderUI(trader, buyPrice, sellPrice, penalty) {
            document.getElementById(`velocity-${trader.id}`).textContent = 
                trader.velocityScore.toFixed(1);
            document.getElementById(`velocity-bar-${trader.id}`).style.width = 
                `${trader.velocityScore}%`;
            document.getElementById(`velocity-bar-${trader.id}`).textContent = 
                `${trader.velocityScore.toFixed(0)}%`;
            
            document.getElementById(`trades-${trader.id}`).textContent = trader.trades;
            document.getElementById(`tpm-${trader.id}`).textContent = 
                trader.tradesPerMinute.toFixed(1);
            document.getElementById(`hold-${trader.id}`).textContent = 
                `${trader.avgHoldingTime.toFixed(0)}s`;
            
            document.getElementById(`buy-price-${trader.id}`).textContent = 
                `$${buyPrice.toFixed(2)}`;
            document.getElementById(`sell-price-${trader.id}`).textContent = 
                `$${sellPrice.toFixed(2)}`;
            document.getElementById(`penalty-${trader.id}`).textContent = 
                penalty > 0 ? `$${(penalty * 2).toFixed(2)}` : '$0.00';

            updateStats();
        }

        // Update global stats
        function updateStats() {
            document.getElementById('activeTraders').textContent = traders.length;
            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('highVelocity').textContent = 
                traders.filter(t => t.velocityScore > 60).length;
            document.getElementById('adjustments').textContent = adjustmentsApplied;
        }

        // Update market price periodically
        setInterval(() => {
            marketPrice = 50000 + (Math.random() - 0.5) * 1000;
            document.getElementById('marketPrice').textContent = `$${marketPrice.toFixed(2)}`;
        }, 5000);

        // Update control displays
        document.getElementById('spreadMultiplier').addEventListener('input', (e) => {
            document.getElementById('spreadValue').textContent = `${e.target.value}x`;
        });

        document.getElementById('velocityThreshold').addEventListener('input', (e) => {
            document.getElementById('thresholdValue').textContent = e.target.value;
        });

        // Reset simulation
        function resetSimulation() {
            traders = [];
            totalTrades = 0;
            adjustmentsApplied = 0;
            traderIdCounter = 0;
            document.getElementById('traderGrid').innerHTML = '';
            updateStats();
        }

        // Initialize with demo traders
        window.addEventListener('load', () => {
            addTrader('scalper');
            addTrader('normal');
            addTrader('longterm');
        });
    </script>
</body>
</html>
